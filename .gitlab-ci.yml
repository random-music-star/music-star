stages:
  - deploy

deploy-frontend:
  stage: deploy
  tags:
    - prod
  only:
    - FE
  script:
    - echo "=== Starting direct deployment process ==="
    - echo "Current directory: $(pwd)"
    - cd "$CI_PROJECT_DIR"
    - echo "=== Updating code from Git repository ==="
    - git checkout FE
    - git pull origin FE
    - echo "=== Changing to frontend directory ==="
    - cd FE
    - echo "=== Current directory: $(pwd) ==="
    - echo "=== Stopping and removing existing container ==="
    - docker stop nextjs-app || true
    - docker rm nextjs-app || true
    - echo "=== Building Docker image ==="
    - docker build -t nextjs-app .
    - echo "=== Starting new container ==="
    - docker run -d -p 3000:3000 --restart always --name nextjs-app nextjs-app
    - echo "=== Checking container status ==="
    - docker ps | grep nextjs-app
  after_script:
    - echo "=== Deployment process finished ==="
